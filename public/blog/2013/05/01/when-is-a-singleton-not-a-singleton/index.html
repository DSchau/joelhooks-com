
<!DOCTYPE HTML>
<html itemscope itemtype="http://schema.org/Article">
<head>
	<meta charset="utf-8">
	<title>AngularJS, Dependency Injection, and when is a singleton not a Singleton? - @jhooks</title>
	<meta name="author" content="Joel Hooks">

	
	<meta name="description" content="The Singleton is the Highlander of design patterns. There can be only one. An example of a Singleton implementation might look something like this: &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Joel Hooks" type="application/atom+xml">
	<link rel="canonical" href="">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">



	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


	<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<meta property="og:description" content="the one where Joel discusses his trials and tribulations as a developer of fine software." />
<meta property="og:image" content="/images/highlander.jpg " />
<meta property="og:title" value="AngularJS, Dependency Injection, and when is a singleton not a Singleton? - Joel Hooks" />
<meta property="og:url" value="http://joelhooks.com/blog/2013/05/01/when-is-a-singleton-not-a-singleton/" />                    
<meta property="og:type" content="website" />                                    
 

<script type="text/javascript" src="//use.typekit.net/wbq6rdy.js"></script>
<script type="text/javascript">try {
    Typekit.load();
} catch (e) {
}</script>

<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=48528,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

<script type="text/javascript">
    if(typeof(_vis_opt_top_initialize) == "function") {
    // Code for Custom Goal: Goal #4
     _vis_opt_goal_conversion(200);
    // uncomment the following line to introduce a half second pause to ensure goal always registers with the server
    _vis_opt_pause(500);
    }
</script>




</head>


<body>
	
	<header id="header" class="inner">
<a href="/"><div class="myface">

</div></a>


<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/jhooks" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/joelhooks" title="GitHub">GitHub</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>

</nav>

</header>
	<div id="content" class="inner"><article class="post">

	<h1 itemprop="name" class="title article-title">AngularJS, Dependency Injection, and when is a singleton not a Singleton?</h1>
	<div class="date">








  


<time datetime="2013-05-01T17:31:00-07:00" pubdate data-updated="true">May 2013</time> <strong>by</strong> <a href="/about">Joel Hooks</a></div>

	<div class="entry-content">
		
			<div class="article-image">
			<img itemprop="image" src="//d7jttttzl6muv.cloudfront.net/images/highlander.jpg" alt="There can be only one.">
			</div>
		
		<p>The Singleton is the Highlander of design patterns. <strong>There can be only one</strong>.</p>

<p>An example of a Singleton implementation might look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">global</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">MySingletonClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nx">MySingletonClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_singletonInstance</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">MySingletonClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_singletonInstance</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">MySingletonClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_singletonInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">Foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// ...</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySingletonClass</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySingletonClass</span><span class="p">();</span>
</span><span class='line'><span class="nx">global</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}(</span><span class="nb">window</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://stackoverflow.com/a/6733919/87002">from Tom Roggero</a></p>

<p>The above JavaScript is from an <a href="http://stackoverflow.com/questions/1635800/javascript-best-singleton-pattern">answer</a>
from StackOverflow that seemed resonable. I&rsquo;ve never actually needed an enforced Singleton in JavaScript.
I suspect I never will, but&hellip; know thy enemy!</p>

<p>Singletons have some use cases, but it is generally considered poor form to use
them. They are especially bothersome when you start trying to unit test your
code. They effectively create global state, and shared state is a real pain to
manage when you are writing unit tests.</p>

<p>It <strong>is</strong> extremely handy to only have one instance of a thing within a certain
context, so how do we gain the benefit of a Singleton, without the pain?</p>

<h2>Dependency Injection (DI)</h2>

<p><a href="http://en.wikipedia.org/wiki/Dependency_injection">Dependency injection</a> is a lovely thing. It can be accomplished in several ways, from simply
passing arguments into a constructor, to full blown DI containers like
<a href="https://code.google.com/p/google-guice/">Guice</a>,
<a href="https://github.com/tschneidereit/SwiftSuspenders">SwiftSuspenders</a>, and
<a href="http://angularjs.org/">AngularJS</a>. I&rsquo;m not going to go to deep in this post, but <a href="http://joelhooks.com/2009/07/12/inversion-of-control-and-dependency-injection-in-flex-using-the-parsley-application-framework-part-1/">here is one from
the archives</a> that is still relevant (if you don&rsquo;t mind a little AS3). <a href="http://misko.hevery.com/2008/11/11/clean-code-talks-dependency-injection/">Here are a couple</a> of awesome talks from Mi≈°ko Hevery that I highly recommend.</p>

<p>Most containers have a mechanism for
providing <em>context-based singletons</em>.</p>

<h2>Context-Based singletons.</h2>

<p>With a DI container, we have contexts. In the case of AngularJS, we have
the application module, which provides the overall container for a given
application. Within this container we define dependencies that can be
liberally injected into other actors within the module, such as directives,
controllers, and/or utility classes. The module and its sub-modules <strong>are</strong> the context.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;someModule&quot;</span><span class="p">,</span> <span class="p">[]).</span>
</span><span class='line'>    <span class="nx">service</span><span class="p">(</span><span class="s2">&quot;mySingletonThing&quot;</span><span class="p">,</span> <span class="nx">MySingletonThing</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s a very typical line of config code in an AngularJS application. This configures
a service for <code>someModule</code> called <code>mySingletonThing</code>. <code>mySingletonThing</code> is a
singleton, but it is not a Singleton. <code>MySingletonThing</code> does not enforce its
singleton nature. We can create as many instances as we desire. We won&rsquo;t, but it
is nice to have freedom. ;)</p>

<p>Instead we rely on AngularJS&rsquo;s ability to inject dependencies.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;someModule&quot;</span><span class="p">).</span>
</span><span class='line'>    <span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;MyController&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mySingletonThing&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mySingletonThing</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//do stuff</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;someModule&quot;</span><span class="p">).</span>
</span><span class='line'>    <span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;MyOtherController&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mySingletonThing&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mySingletonThing</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">hahaTakeThat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySingletonThing</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hahaTakeThat</span> <span class="o">===</span> <span class="nx">mySingletonThing</span><span class="p">);</span> <span class="c1">//false</span>
</span><span class='line'>    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we talk about a context-based singleton, these defined dependencies
are what we mean. Within a given context the <em>DI container</em> will only allow a single
instance of the object to be injected. The object itself does not protect
against or prevent multiple instances. You can <code>new</code>, <code>new</code>, <code>new</code> it all day long,
and there will be no complaints. With objects managed by a DI container you
should <em>never</em> need to use <code>new</code> for objects that are injectable.</p>

<p>This provides you with all the benefits of a Singleton, with none of the
sadness. Now when you write your units tests, you can use as many individual instances as
you might need, without managing global state. <strong>Joy</strong>.</p>

<p>With Angular&rsquo;s DI implementation, we are a bit limited. Within a given module, we only
have access to a single context. This limits some flexibility that would
be gained by allowing nested contexts. Consider for example a user with
multiple accounts. What I&rsquo;d really like is for each account to represent a
context that could have its <strong>own</strong> singleton objects. It would be <strong>very</strong>
handy to dynamically add/remove account sub-modules from the user. The singleton
injectables defined in the user module would cascade to sub-modules, but a
sub-module could also define its own singleton mappings, perhaps even overriding
the parent module&rsquo;s. I don&rsquo;t know if this is on the roadmap, but it would be awesome to
have a more robust injector.</p>

<h2>Conclusion</h2>

<p>A Singleton is a singleton, but a singleton is not <strong>always</strong> a Singleton in the
<em>formal</em> sense. The enforced Singleton is generally regarded as &ldquo;<strong>to be avoided</strong>&rdquo;, but context-based
singletons are an extremely useful tool that play nice and
don&rsquo;t represent hairy global state. YMMV</p>

	</div>
	
	<div class="contact">Want to chat about this post? I'd love to hear from you. <br>You can find me on twitter <a href="http://twitter.com/jhooks" rel="author">@jhooks</a>, <a href="https://plus.google.com/+JoelHooks?rel=author" rel="author">google+</a>, or via email <a href="mailto:joelhooks@gmail.com?Subject=Hello%20,%20email%20from%20joelhooks.com">joelhooks@gmail.com</a></div>



</article>

</div>
	<footer id="footer" class="inner"><p>
you can learn more about me <a href="/about"> here.</a>
</p>
<p>
  ~ Copyright &copy; 2018 - Joel Hooks -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> ~
</p>


</footer>
	<script type="text/javascript" src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-246705-7']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);

		})();
		setTimeout(function() {
		   window.onscroll = function() {
		     window.onscroll = null; // Only track the event once
		     _gaq.push(['_trackEvent', 'scroll', 'read']);
		   }
		 }, 5000);
	</script>



    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>

    <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '51ddb932613f5d3030000126');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>


</script>
</body>
</html>
