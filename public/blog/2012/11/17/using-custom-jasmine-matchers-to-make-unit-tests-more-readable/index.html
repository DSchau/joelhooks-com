
<!DOCTYPE HTML>
<html itemscope itemtype="http://schema.org/Article">
<head>
	<meta charset="utf-8">
	<title>Using Custom Jasmine Matchers to Make Unit Tests More Readable - @jhooks</title>
	<meta name="author" content="Joel Hooks">

	
	<meta name="description" content="Image from purplemattfish I&rsquo;m a stickler for the &ldquo;single assertion per test&rdquo; guideline. One of the pillars of good unit tests is &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Joel Hooks" type="application/atom+xml">
	<link rel="canonical" href="">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">



	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


	<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<meta property="og:description" content="the one where Joel discusses his trials and tribulations as a developer of fine software." />
<meta property="og:image" content="/images/head.png" />
<meta property="og:title" value="Using Custom Jasmine Matchers to Make Unit Tests More Readable - Joel Hooks" />
<meta property="og:url" value="http://joelhooks.com/blog/2012/11/17/using-custom-jasmine-matchers-to-make-unit-tests-more-readable/" />                    
<meta property="og:type" content="website" />                                    
 

<script type="text/javascript" src="//use.typekit.net/wbq6rdy.js"></script>
<script type="text/javascript">try {
    Typekit.load();
} catch (e) {
}</script>

<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=48528,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

<script type="text/javascript">
    if(typeof(_vis_opt_top_initialize) == "function") {
    // Code for Custom Goal: Goal #4
     _vis_opt_goal_conversion(200);
    // uncomment the following line to introduce a half second pause to ensure goal always registers with the server
    _vis_opt_pause(500);
    }
</script>




</head>


<body>
	<div class="topbar">
		<div class="inner">
			<div class="form">				
				<form name="header_signup" action="http://joelhooks.us6.list-manage.com/subscribe/post?u=cab7a76220&amp;id=e3b711e732" method="post">
					<div class="text"><strong>Weekly AngularJS Content Sent Right to Your Inbox:</strong></div>
					<div class="button-container">
			        <input class="input" type="email" name="EMAIL" placeholder="hey@you.com"> 
			        
			        <a class="button"  onclick="if(typeof(_vis_opt_top_initialize) =='function'){ _vis_opt_goal_conversion(200); _vis_opt_pause(500); } document.header_signup.submit();" href="#">Keep me Updated!</a>
			        </div>
			        <div class="text">(1~2 emails a week. No spam.)</div>
		      	</form>	    
			</div>

		</div>

	</div>
	<header id="header" class="inner">
<a href="/"><div class="myface">

</div></a>


<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/jhooks" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/joelhooks" title="GitHub">GitHub</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>

</nav>

</header>
	<div id="content" class="inner"><article class="post">

	<h1 itemprop="name" class="title article-title">Using Custom Jasmine Matchers to Make Unit Tests More Readable</h1>
	<div class="date">








  


<time datetime="2012-11-17T10:55:00-06:00" pubdate data-updated="true">November 2012</time></div>

	<div class="entry-content">
		
		<p><img src="/images/clean_and_dry.jpg" alt="Clean and Dry" /></p>

<p><a href="http://www.flickr.com/photos/29601732@N06/3969905051/">Image from purplemattfish</a></p>

<p>I&rsquo;m a stickler for the &ldquo;single assertion per test&rdquo; guideline. One of the pillars of good unit tests is readability. Multiple asserts undermine this principle and make tests that are more difficult to read, understand, and maintain. A clean solution to this problem is to use custom Jasmine matchers in place of multiple assertions.</p>

<h2>Keep it DRY, Even (Especially?) in Tests</h2>

<p>Consider the following:</p>

<div><script src='https://gist.github.com/4097691.js?file=BloatedDateTest.js'></script>
<noscript><pre><code>it(&quot;convertToDate should turn a splitDate into a Date object&quot;, function() {
    var splitDate = {year: 2012, month: 11, day: 17},
        date = dateUtil.splitDateToDate(splitDate);
    
    expect(date instanceof Date).toBe(true);
    expect(date.getFullYear()).toBe(splitDate.year);
    expect(date.getMonth()).toBe(splitDate.month - 1);
    expect(date.getDate()).toBe(splitDate.day);
});
</code></pre></noscript></div>


<p>In our app, we recieve a &ldquo;split date&rdquo; object from our service. It returns a value in the <code>{year: 2012, month: 11, day: 17}</code> format. We have some functionality that will convert the format back and for to a JavaScript <code>Date</code>.</p>

<p>This seems straight forward enough, but as it turns out we need to go the other direction as well:</p>

<div><script src='https://gist.github.com/4097691.js?file=AnotherBloatedDateTest.js'></script>
<noscript><pre><code>it(&quot;convertToSplitDate should turen a Date into a split date&quot;, function() {
    var date = new Date(2012, 10, 17),
        splitDate = dateUtil.convertDateToSplitDate(date);

    expect(splitDate).toBeDefined();
    expect(splitDate.year).toBe(date.year);
    expect(splitDate.month - 1).toBe(date.month);
    expect(splitDate.day).toBe(date.day);
});</code></pre></noscript></div>


<p>This is bothersome. We have two stacks of <code>expect</code> calls that are very similar, but different enough to require a bit more than a helper method. We definitely want to verify all of the properties of the results, but do we really need to do this individually? The short answer is &lsquo;no.&rsquo;</p>

<h2>Enter the Custom Matcher</h2>

<div><script src='https://gist.github.com/4097691.js?file=CustomMatchers.js'></script>
<noscript><pre><code>//Jasmine will call this before EVERY spec.
beforeEach(function () {
    function isValidSplitDate(splitDate) {
        return splitDate &amp;&amp; !isNaN(splitDate.year) &amp;&amp; !isNaN(splitDate.month) &amp;&amp; !isNaN(splitDate.day);
    }

    function convertSplitDateToDate(splitDate) {
        if (isValidSplitDate(splitDate)) {
            splitDate = new Date(splitDate.year, splitDate.month - 1, splitDate.day);
        }
        return splitDate;
    }
   
    //addMatchers() is a method that Jasmine will see and understand to 
    //make the custom matchers within easy to understand.
    this.addMatchers({
        toEqualDate: function (expectedDate) {
            var areDates;

            expectedDate = convertSplitDateToDate(expectedDate);
            this.actual = convertSplitDateToDate(this.actual);

            areDates = this.actual instanceof Date &amp;&amp; expectedDate instanceof Date;

            //Jasmine will look for this function and utilize it for custom error messages
            this.message = function () {
                if (areDates) {
                    return &quot;Expected date of &quot; + this.actual + &quot; to be &quot; + expectedDate;
                }
                return &quot;Expected &quot; + this.actual + &quot; and &quot; + expectedDate + &quot; to be valid Date/SplitDate objects. They were not.&quot;;
            };

            if (areDates) {
                //Ultimately Jasmine expects a matcher to return true or false
                return (this.actual.getTime() === expectedDate.getTime());
            }

            return false;
        }
    });
});</code></pre></noscript></div>


<p>A custom matcher is nestled in a <code>beforeEach</code> function. This will cause Jasmine to load the matcher prior to EVERY <code>describe</code> and <code>it</code> in your test suite.</p>

<p>Within the <code>beforeEach</code> is <code>this.addMatcher</code> that takes an <code>object</code> whose properties are your actual custom matchers. In our example the &lsquo;toEqualDate&rsquo; matcher is the only property, but you can add as many as you might need for your application.</p>

<p>In the scope of the <code>toEqualDate</code> function, we pass in the <code>expectedDate</code> parameter. This is the argument passed into <code>toEqualDate(myExpectedDate)</code>. We also have access to <code>this.actual</code> that is the argument passed into <code>expect(myActualDate)</code> within your test.</p>

<p>The next important bit is the <code>this.message</code> function that Jasmine will use to display any custom error messages. In this case we are returning two messages as appropriate. The first will return an invalid match, and the second will return a message if either object is not a valid date (if they are undefined, null, or incorrectly formatted).</p>

<p>Finally the <code>toEqualDate</code> function will return true or false based on the values we are comparing. If they are indeed valid <code>Date</code> objects, it will compare them. If they are not, we return false.</p>

<p>At the top of the <code>beforeEach</code> we also have two utility methods to clean up our custom matcher.</p>

<h2>Keeping it Clean and DRY</h2>

<div><script src='https://gist.github.com/4097691.js?file=CleanTests.js'></script>
<noscript><pre><code>it(&quot;convertToDate should turn a splitDate into a Date object&quot;, function() {
    var splitDate = {year: 2012, month: 11, day: 17},
        date = dateUtil.splitDateToDate(splitDate);
    
    expect(date).toEqualDate(splitDate);
});

it(&quot;convertToSplitDate should turen a Date into a split date&quot;, function() {
    var date = new Date(2012, 10, 17),
        splitDate = dateUtil.convertDateToSplitDate(date);

    expect(splitDate).toEqualDate(date);
});</code></pre></noscript></div>


<p>I don&rsquo;t know about you, but these tests look a <strong>lot</strong> better to me. While the overall lines of code may have increased, we&rsquo;ve created a reusable solution that can be used over and over again while not repeating ourselves. Our tests now have a single <code>expect</code> that is easy to understand and clearly expresses the intent of the test in an easy to read way.</p>

<h2>Additional Reading</h2>

<p><a href="https://github.com/pivotal/jasmine/wiki/Matchers">Official Documentation on Jasmine Matcher</a></p>

<p><a href="http://lostechies.com/derickbailey/2011/09/03/custom-jasmine-matchers-for-clarity-in-testing-backbone-js-models/">Custom Jasmine Matchers For Clarity In Testing Backbone.js Models</a></p>

<p><a href="http://testdrivenwebsites.com/2010/08/04/custom-jquery-matchers-in-jasmine/">Custom jQuery matchers in Jasmine</a></p>

	</div>

	<div class="contact">Want to chat about this post? I'd love to hear from you. <br>You can find me on twitter <a href="http://twitter.com/jhooks" rel="author">>@jhooks</a>, <a href="https://plus.google.com/+JoelHooks?rel=author" rel="author">google+</a>, or via email <a href="mailto:joelhooks@gmail.com?Subject=Hello%20,%20email%20from%20joelhooks.com">joelhooks@gmail.com</a></div>

	
	<div class="cta">
		<div class="signup">
		    <p class="message">
		      <a id="signup-for-updates"></a>
              Get weekly AngularJS content and curated links. Keep up to date with the latest, <strong>sign up below</strong>:
		    </p>

		    <div>
		      <form name="signup" action="http://joelhooks.us6.list-manage.com/subscribe/post?u=cab7a76220&amp;id=e3b711e732" method="post">
		        <input class="input" type="email" name="EMAIL" placeholder="Email Address"> 
		        <div class="button_container"><a class="button" onclick="if(typeof(_vis_opt_top_initialize) =='function'){ _vis_opt_goal_conversion(200); _vis_opt_pause(500); } setTimeout(function(){document.signup.submit();},500);" href="#">Send Me Updates!</a></div>
		        <div class="arrow"></div>
		      </form>
		    </div>
		    <p class="small">I will <strong>never</strong> spam you. Unsubscribe at anytime.</p>

	    </div>
    </div>
    


</article>

</div>
	<footer id="footer" class="inner"><p>
you can learn more about me <a href="/about"> here.</a>
</p>
<p>
  ~ Copyright &copy; 2014 - Joel Hooks -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> ~
</p>


</footer>
	<script type="text/javascript" src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-246705-7']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);

		})();
		setTimeout(function() {
		   window.onscroll = function() {
		     window.onscroll = null; // Only track the event once
		     _gaq.push(['_trackEvent', 'scroll', 'read']);
		   }
		 }, 5000);
	</script>



    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>

    <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '51ddb932613f5d3030000126');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>


</script>
</body>
</html>
