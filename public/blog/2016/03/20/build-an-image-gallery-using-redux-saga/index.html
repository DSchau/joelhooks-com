
<!DOCTYPE HTML>
<html itemscope itemtype="http://schema.org/Article">
<head>
	<meta charset="utf-8">
	<title>Build an Image Gallery Using React, Redux and redux-saga - @jhooks</title>
	<meta name="author" content="Joel Hooks">

	
	<meta name="description" content="Building an Image Gallery The image gallery we will build is a simple application that displays an array of image URLs loaded from a service (Flickr &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Joel Hooks" type="application/atom+xml">
	<link rel="canonical" href="">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">



	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


	<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<meta property="og:description" content="the one where Joel discusses his trials and tribulations as a developer of fine software." />
<meta property="og:image" content="/images/saga.jpg " />
<meta property="og:title" value="Build an Image Gallery Using React, Redux and redux-saga - Joel Hooks" />
<meta property="og:url" value="http://joelhooks.com/blog/2016/03/20/build-an-image-gallery-using-redux-saga/" />                    
<meta property="og:type" content="website" />                                    
 

<script type="text/javascript" src="//use.typekit.net/wbq6rdy.js"></script>
<script type="text/javascript">try {
    Typekit.load();
} catch (e) {
}</script>

<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=48528,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

<script type="text/javascript">
    if(typeof(_vis_opt_top_initialize) == "function") {
    // Code for Custom Goal: Goal #4
     _vis_opt_goal_conversion(200);
    // uncomment the following line to introduce a half second pause to ensure goal always registers with the server
    _vis_opt_pause(500);
    }
</script>




</head>


<body>
	
	<header id="header" class="inner">
<a href="/"><div class="myface">

</div></a>


<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/jhooks" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/joelhooks" title="GitHub">GitHub</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>

</nav>

</header>
	<div id="content" class="inner"><article class="post">

	<h1 itemprop="name" class="title article-title">Build an Image Gallery Using React, Redux and redux-saga</h1>
	<div class="date">








  


<time datetime="2016-03-20T15:57:00-07:00" pubdate data-updated="true">March 2016</time> <strong>by</strong> <a href="/about">Joel Hooks</a></div>

	<div class="entry-content">
		
			<div class="article-image">
			<img itemprop="image" src="//d7jttttzl6muv.cloudfront.net/images/saga.jpg" alt="">
			</div>
		
		<h1>Building an Image Gallery</h1>

<p>The image gallery we will build is a simple application that displays an array of image URLs loaded from a service (Flickr), and allows the user to select them individually.</p>

<p><img src="https://s3.amazonaws.com/f.cl.ly/items/3v0l00410J1Z1j310b24/Screen%20Shot%202016-03-20%20at%203.42.17%20PM.png?v=1b32daca" alt="" /></p>

<p>It will be built with React, using Redux and redux-saga. React is being used as the core framework to take advantage of its virtual-dom implementation. Redux will handle the management of state within the application. Finally, we will use redux-saga to handle the complexity of asynchronous sequences.</p>

<p>We will write the gallery in ES6 (arrow functions, modules, and template strings!), so we will need to do a bit of project setup to get going.</p>

<h2>Project Setup and Automation</h2>

<p>There is a significant array of options when it comes to getting started with a React application. For this simple app, we want to keep it as minimal as possible. We are going to use Babel to transpile ES6 into good olâ€™ ES5 for the browser, budo/browserify to serve it locally, and tape to test.</p>

<p>Create a file called <code>package.json</code> in a new project folder and add the following contents to it:</p>

<h3>package.json</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;egghead-react-redux-image-gallery&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Redux Saga beginner tutorial&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="s2">&quot;src/main.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="s2">&quot;babel-node ./src/saga.spec.js | tap-spec&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;budo ./src/main.js:build.js --dir ./src --verbose  --live -- -t babelify&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;repository&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;git&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;git+https://github.com/joelhooks/egghead-react-redux-image-gallery.git&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;author&quot;</span><span class="o">:</span> <span class="s2">&quot;Joel Hooks &lt;joelhooks@gmail.com&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;license&quot;</span><span class="o">:</span> <span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;babel-polyfill&quot;</span><span class="o">:</span> <span class="s2">&quot;6.3.14&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;react&quot;</span><span class="o">:</span> <span class="s2">&quot;^0.14.3&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;react-dom&quot;</span><span class="o">:</span> <span class="s2">&quot;^0.14.3&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;react-redux&quot;</span><span class="o">:</span> <span class="s2">&quot;^4.4.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;redux&quot;</span><span class="o">:</span> <span class="s2">&quot;^3.3.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;redux-saga&quot;</span><span class="o">:</span> <span class="s2">&quot;^0.8.0&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;devDependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;babel-cli&quot;</span><span class="o">:</span> <span class="s2">&quot;^6.1.18&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;babel-core&quot;</span><span class="o">:</span> <span class="s2">&quot;6.4.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;babel-preset-es2015&quot;</span><span class="o">:</span> <span class="s2">&quot;^6.1.18&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;babel-preset-react&quot;</span><span class="o">:</span> <span class="s2">&quot;^6.1.18&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;babel-preset-stage-2&quot;</span><span class="o">:</span> <span class="s2">&quot;^6.1.18&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;babelify&quot;</span><span class="o">:</span> <span class="s2">&quot;^7.2.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;browserify&quot;</span><span class="o">:</span> <span class="s2">&quot;^13.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;budo&quot;</span><span class="o">:</span> <span class="s2">&quot;^8.0.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;tap-spec&quot;</span><span class="o">:</span> <span class="s2">&quot;^4.1.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;tape&quot;</span><span class="o">:</span> <span class="s2">&quot;^4.2.2&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the <code>package.json</code> in place, you can run <code>npm install</code> in the project folder and install all of the dependencies that we will need.</p>

<p>We&rsquo;re also going to need to configure Babel with a <code>.babelrc</code> file in the project folder that contains the Babel presets that we want to use:</p>

<h3>.babelrc</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;presets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;es2015&quot;</span><span class="p">,</span> <span class="s2">&quot;react&quot;</span><span class="p">,</span> <span class="s2">&quot;stage-2&quot;</span><span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This file tells babel that we will be using ES2015 (ES6), React, and stage-2 features of the emerging ECMAScript standard (ES2016).</p>

<p>The <code>package.json</code> has two standard scripts configured called <code>start</code> and <code>test</code>. For right now, we want to get <code>start</code> working so we can load the application. The <code>start</code> script is currently configured to look inside of a folder called <code>src</code> so <em>create a folder called <code>src</code></em> in the project directory and add the following files:</p>

<h3>index.html</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!doctype html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>egghead: React Redux Image Gallery<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;styles.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;http://cloud.egghead.io/2G021h3t2K10/download/egghead-logo-head-only.svg&quot;</span> <span class="na">class=</span><span class="s">&quot;egghead&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h3&gt;</span>Egghead Image Gallery<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;build.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>main.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="s2">&quot;babel-polyfill&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">React</span><span class="o">!&lt;</span><span class="err">/h1&gt;,</span>
</span><span class='line'>  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>styles.css</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">body</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">font-family</span><span class="o">:</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="n">Sans</span><span class="o">-</span><span class="n">Serif</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
</span><span class='line'>    <span class="k">background</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.title</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>    <span class="k">padding</span><span class="o">:</span> <span class="m">2px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.egghead</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">width</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.image-gallery</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">width</span><span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>    <span class="n">flex</span><span class="o">-</span><span class="k">direction</span><span class="o">:</span> <span class="n">column</span><span class="p">;</span>
</span><span class='line'>    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">darkgray</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.gallery-image</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">height</span><span class="o">:</span> <span class="m">250px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>    <span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>    <span class="k">justify</span><span class="o">-</span><span class="k">content</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.gallery-image</span> <span class="nt">img</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">width</span><span class="o">:</span> <span class="m">100</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'>    <span class="k">max-height</span><span class="o">:</span> <span class="m">250px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.image-scroller</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>    <span class="k">justify</span><span class="o">-</span><span class="k">content</span><span class="o">:</span> <span class="n">space</span><span class="o">-</span><span class="n">around</span><span class="p">;</span>
</span><span class='line'>    <span class="k">overflow</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>    <span class="k">overflow-y</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.image-scroller</span> <span class="nt">img</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">height</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">padding</span><span class="o">:</span> <span class="m">1px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>index.html</code> loads the <code>styles.css</code> to give us some basic styling/layout. It also loads the script <code>build.js</code>, which is a <em>generated</em> file. Our <code>main.js</code> is a very basic React application that renders an <code>h1</code> into the <code>#root</code> element inside of <code>index.html</code>. With these files in place, you should now be able to run <strong><code>npm start</code></strong> in the project folder and navigate to <a href="http://10.11.12.1:9966/">http://10.11.12.1:9966/</a> and see the following:</p>

<p><img src="https://s3.amazonaws.com/f.cl.ly/items/2I1V0o2c1d281f3i3408/Screen%20Shot%202016-03-20%20at%204.31.06%20PM.png?v=1720e99d" alt="" /></p>

<p>Now we will build the base <code>Gallery</code> React component.</p>

<h2>Displaying some images in the gallery.</h2>

<p>First thing&rsquo;s first, and we want to get some images displayed as quickly as possible! We will create a <code>Gallery</code> component that will display our images. In the project folder, create a file called <code>Gallery.js</code> with the following contents.</p>

<h3>Gallery.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">flickrImages</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="s2">&quot;https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg&quot;</span>
</span><span class='line'><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Gallery</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">images</span><span class="o">:</span> <span class="nx">flickrImages</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">selectedImage</span><span class="o">:</span> <span class="nx">flickrImages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="p">{</span><span class="nx">images</span><span class="p">,</span> <span class="nx">selectedImage</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;image-gallery&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;gallery-image&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">selectedImage</span><span class="p">}</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;image-scroller&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="p">{</span><span class="nx">images</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">image</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">image</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>          <span class="p">))}</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve hard coded an array of data into this component, which is a great way to start working quickly. The <code>Gallery</code> extends <code>Component</code>, and in its constructor we set the initial state of the component. Finally, we render a basic structure with some styled markup. The <code>image-scroller</code> element uses the images array to produce multiple elements using <code>map</code>.</p>

<p>With the <code>Gallery</code> created, we can update <code>main.js</code> to load the gallery:</p>

<h3>main.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import &quot;babel-polyfill&quot;
</span><span class='line'>
</span><span class='line'>import React from &#39;react&#39;
</span><span class='line'>import ReactDOM from &#39;react-dom&#39;
</span><span class='line'>
</span><span class='line'><span class="gi">+ import Gallery from &#39;./Gallery&#39;</span>
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'><span class="gd">-  &lt;h1&gt;Hello React!&lt;/h1&gt;,</span>
</span><span class='line'><span class="gi">+  &lt;Gallery /&gt;,</span>
</span><span class='line'>  document.getElementById(&#39;root&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>For now, we are using the hard-coded image URLs (via the <code>flickrImages</code> array), and displaying the first image url as the <code>selectedImage</code>. We&rsquo;re accessing these properties by setting a default initial state within the <code>Gallery</code> component class constructor.</p>

<p><img src="https://s3.amazonaws.com/f.cl.ly/items/1T3G3p3T2q2H00472T1C/Screen%20Shot%202016-03-20%20at%204.51.14%20PM.png?v=afdd9bf7" alt="" /></p>

<p>We can add interactivity to the gallery with an event handler that calls the <code>setState</code> method on the <code>Gallery</code> component:</p>

<h3>Gallery.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export default class Gallery extends Component {
</span><span class='line'>  constructor(props) {
</span><span class='line'>    super(props);
</span><span class='line'>    this.state = {
</span><span class='line'>      images: flickrImages,
</span><span class='line'>      selectedImage: flickrImages[0]
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'><span class="gi">+  handleThumbClick(selectedImage) {</span>
</span><span class='line'><span class="gi">+    this.setState({</span>
</span><span class='line'><span class="gi">+      selectedImage</span>
</span><span class='line'><span class="gi">+   })</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'>  render() {
</span><span class='line'>    const {images, selectedImage} = this.state;
</span><span class='line'>    return (
</span><span class='line'>      &lt;div className=&quot;image-gallery&quot;&gt;
</span><span class='line'>        &lt;div className=&quot;gallery-image&quot;&gt;
</span><span class='line'>          &lt;div&gt;
</span><span class='line'>            &lt;img src={selectedImage} /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div className=&quot;image-scroller&quot;&gt;
</span><span class='line'>          {images.map((image, index) =&gt; (
</span><span class='line'><span class="gd">-            &lt;div key={index}&gt;</span>
</span><span class='line'><span class="gi">+            &lt;div key={index} onClick={this.handleThumbClick.bind(this,image)}&gt;</span>
</span><span class='line'>              &lt;img src={image}/&gt;
</span><span class='line'>            &lt;/div&gt;
</span><span class='line'>          ))}
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    )
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>By adding <code>handleThumbClick</code> to the <code>Gallery</code> component class, we can access it in any elements <code>onClick</code> method. Note that we are using <code>bind(this,image)</code> in the <code>onClick</code>. By passing <code>image</code> as the second argument, it is sent as the first argument to <code>handleThumbClick</code>. This use of bind is an extermely handy way to pass <em>context</em> to an event handler.</p>

<p>Looking good! Now we have some interaction, and something that resembles an &ldquo;app&rdquo;. Now that we&rsquo;ve dealt with getting the application running and displaying data, we can consider loading some remote data. The most obvious place to do that is one of the React component lifecycle methods. We will use <code>componentDidMount</code> and make a call to the Flickr API and load some images:</p>

<h3>Gallery.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export default class Gallery extends Component {
</span><span class='line'>  constructor(props) {
</span><span class='line'>    super(props);
</span><span class='line'>    this.state = {
</span><span class='line'>      images: flickrImages,
</span><span class='line'>      selectedImage: flickrImages[0]
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'><span class="gi">+  componentDidMount() {</span>
</span><span class='line'><span class="gi">+    const API_KEY = &#39;a46a979f39c49975dbdd23b378e6d3d5&#39;;</span>
</span><span class='line'><span class="gi">+    const API_ENDPOINT = `https://api.flickr.com/services/rest/?method=flickr.interestingness.+getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5`;+</span>
</span><span class='line'><span class="gi">+</span>
</span><span class='line'><span class="gi">+    fetch(API_ENDPOINT).then((response) =&gt; {</span>
</span><span class='line'><span class="gi">+      return response.json().then((json) =&gt; {</span>
</span><span class='line'><span class="gi">+        const images = json.photos.photo.map(({farm, server, id, secret}) =&gt; { </span>
</span><span class='line'><span class="gi">+            return `https://farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg`</span>
</span><span class='line'><span class="gi">+        });</span>
</span><span class='line'><span class="gi">+</span>
</span><span class='line'><span class="gi">+        this.setState({images, selectedImage: images[0]});</span>
</span><span class='line'><span class="gi">+      })</span>
</span><span class='line'><span class="gi">+    })</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'>[...]
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve added a new method to the Gallery class. We are using React&rsquo;s <code>componentDidMount</code> lifecycle method to trigger the loading of data from Flickr. Lifecycle methods are called by React at specific times in a component&rsquo;s lifecycle. In this case, the method will be called whenever the component is added to the DOM. Note that the Gallery component is only added to the DOM once, so this will give us our initial load of images. For a more dynamic component that is loaded and unloaded over an application&rsquo;s lifecycle, this might cause excessive service calls or other unforeseen results.</p>

<p>We are using the <code>fetch</code> browser API to make a request to Flickr. Fetch returns a promise that resolves with <code>response</code> object. Calling <code>response.json()</code> gives us another promise, which is the actual JSON result we are looking for. We&rsquo;ll map over the photos to create an array of Flickr image urls.</p>

<blockquote><p>Let&rsquo;s be honest. This application is simple. We could stop right here and we&rsquo;d have the basic requirements done. Maybe we add an error handler in the fetch promise chain, some logic to see if there are images and <em>DONE!</em> At this point you really have to stop and use your imagination a bit. Simple requirements rarely last in the real world. Soon the application will grow as feature requests roll in. Authentication, a slide show, the ability to load different galleries and images sets&hellip; This <strong>is not</strong> good enough.</p></blockquote>

<p>So now that we have a working image gallery using React, we can start thinking about the foundation of patterns that we want to use to grow the application over time. The first order of business is to take away the <code>Gallery</code> component&rsquo;s power to control the state of the application.</p>

<p>We are going to introduce Redux to manage state instead, so let&rsquo;s get that setup.</p>

<h2>Using Redux to manage state</h2>

<p>Anytime you use <code>setState</code> in your application <em>you&rsquo;ve allowed the Component to become stateful</em>. While this isn&rsquo;t always bad, it can lead to some confusing application code over time, with state management spread from top to bottom in your application.</p>

<p>The Flux architecture is one solution that was introduced to help alleviate this. Flux moves logic and state into Stores. Stores are updated when Actions are dispatched in the application. Updates to Stores will trigger Views to be rendered with the new state.</p>

<p>So why not just drop in Flux? It&rsquo;s &ldquo;official&rdquo; architecture after all.</p>

<p>Well, <strong>Redux is basically Flux</strong>, but with some distinct advantages. Here&rsquo;s what <a href="http://stackoverflow.com/a/32920459/87002">Dan Abramov (the creator of Redux) has to say</a>:</p>

<blockquote><p>Redux is not that different from Flux. Overall it&rsquo;s the same architecture, but Redux is able to cut some complexity corners by using functional composition where Flux uses callback registration.</p>

<p>It&rsquo;s not fundamentally different, but I find it that Redux makes certain abstractions easier, or at least possible to implement, that would be hard or impossible to implement in Flux.</p></blockquote>

<p>The <a href="http://redux.js.org/">Redux documentation</a> is great. Dan is a truly gracious and inspiring individual. If you haven&rsquo;t <a href="https://code-cartoons.com/a-cartoon-intro-to-redux-3afb775501a6#.7cra4lukv">read the code cartoons</a> or watched <a href="https://egghead.io/series/getting-started-with-redux">Dan&rsquo;s free egghead.io series</a>, now is the time!</p>

<h3>Bootstrapping Redux</h3>

<p>The first thing we need to do is get Redux bootstrapped and running in our application. We don&rsquo;t have to install anything, that was all taken care of when we ran <code>npm install</code>, but we do need to import and configure Redux.</p>

<p><strong>The reducer function is the brain of Redux</strong>. When an action is dispatched by the application, the reducer receives the action and creates the piece of application state that the reducer owns. Since <strong>reducers are pure functions</strong>, they can be composed together to create the complete state of the application. Let&rsquo;s create a simple reducer in the <code>src</code> folder:</p>

<h3>reducer.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">images</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A reducer function is a function that takes two arguments.</p>

<ul>
<li><code>state</code> &ndash; this is the data that represents the state of the application. The reducer function will use this state to construct the new state. If no state has changed as result of the action, the reducer will simply return the state input.</li>
<li><code>action</code> &ndash; the event that has triggered the reducer. Actions are dispatched by the store, and handled by reducers. The action is required to have a <code>type</code> property that the reducer uses to apply changes to the new application state.</li>
</ul>


<p>For right now, the <code>images</code> reducer will log to the console to prove that it is connected and ready for work. To use the reducer we need to configure redux in <code>main.js</code>:</p>

<h3>main.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import &quot;babel-polyfill&quot;;
</span><span class='line'>
</span><span class='line'>import React from &#39;react&#39;;
</span><span class='line'>import ReactDOM from &#39;react-dom&#39;;
</span><span class='line'>
</span><span class='line'>import Gallery from &#39;./Gallery&#39;;
</span><span class='line'>
</span><span class='line'><span class="gi">+ import { createStore } from &#39;redux&#39;</span>
</span><span class='line'><span class="gi">+ import reducer from &#39;./reducer&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="gi">+ const store = createStore(reducer);</span>
</span><span class='line'>
</span><span class='line'><span class="gi">+ import {Provider} from &#39;react-redux&#39;;</span>
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'><span class="gi">+  &lt;Provider store={store}&gt;</span>
</span><span class='line'>    &lt;Gallery /&gt;
</span><span class='line'><span class="gi">+  &lt;/Provider&gt;,</span>
</span><span class='line'>  document.getElementById(&#39;root&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>We are going to import the <code>createStore</code> function from the Redux library. <code>createStore</code> is used to create the Redux store. For the most part, we don&rsquo;t interact directly with the store, it is something that Redux manages for us behind the scenes.</p>

<p>We also need to import the reducer function that we&rsquo;ve just created so that it can be delivered to the store.</p>

<p>We will use <code>createStore(reducer)</code> to configure the store with our application&rsquo;s reducer. This example only has a single reducer, but <code>createStore</code> can take multiple reducers arguments. More on that a bit later!</p>

<p>Finally we import the higher-order <code>Provider</code> component from <code>react-Redux</code>. This will wrap our <code>Gallery</code> so that we can make easy use of Redux. We need to pass the store we just created to the <code>Provider</code> so that it can use it for us. You could use Redux without <code>Provider</code>, and in fact, React isn&rsquo;t required to use Redux at all! That&rsquo;s wonderful, but we are going to use <code>Provider</code> because it is very convenient.</p>

<p>If you open your developer tools console, you should see a message!</p>

<p><img src="https://s3.amazonaws.com/f.cl.ly/items/2R3b143J1Y3T400i2c0w/Screen%20Shot%202016-03-20%20at%206.32.23%20PM.png?v=ba488b8e" alt="" /></p>

<p>It may be a bit mysterious, but shows off an interesting point of Redux. <em>All reducers receive all actions that are dispatched in the application.</em> In this case we are seeing an action that Redux itself dispatches.</p>

<h3>Connecting the gallery component</h3>

<p>With Redux, we will use the concept of &ldquo;connected&rdquo; and &ldquo;un-connected&rdquo; components. A connected component is wired into the store, and coordinates and controls action events and the store. Usually a connected component will have children that are &ldquo;pure components&rdquo; that take data as input, and render when that data is updated. These children are unconnected components.</p>

<blockquote><p><strong>note:</strong> While React and Redux play very well together, React is <em>not</em> required for Redux. You can use Redux without React!</p></blockquote>

<p>react-redux provides a convenient wrapper for React components that does most of the heavy lifting required to connect a React component to a Redux store. We will add that to <code>Gallery</code> and make it our primary connected component:</p>

<h3>Gallery.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import React, {Component} from &#39;react&#39;
</span><span class='line'><span class="gi">+import {connect} from &#39;react-redux&#39;;</span>
</span><span class='line'>
</span><span class='line'><span class="gd">-export default class Gallery extends Component {</span>
</span><span class='line'><span class="gi">+export class Gallery extends Component {</span>
</span><span class='line'>  constructor(props) {
</span><span class='line'>    super(props);
</span><span class='line'><span class="gi">+    console.log(props);</span>
</span><span class='line'>    this.state = {
</span><span class='line'>      images: []
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>  componentDidMount() {
</span><span class='line'>    const API_KEY = &#39;a46a979f39c49975dbdd23b378e6d3d5&#39;;
</span><span class='line'>    const API_ENDPOINT = `https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5`;
</span><span class='line'>
</span><span class='line'>    fetch(API_ENDPOINT).then((response) =&gt; {
</span><span class='line'>      return response.json().then((json) =&gt; {
</span><span class='line'>        const images = json.photos.photo.map(({farm, server, id, secret}) =&gt; {
</span><span class='line'>            return `https://farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg`
</span><span class='line'>        });
</span><span class='line'>
</span><span class='line'>        this.setState({images, selectedImage: images[0]});
</span><span class='line'>      })
</span><span class='line'>    })
</span><span class='line'>  }
</span><span class='line'>  handleThumbClick(selectedImage) {
</span><span class='line'>    this.setState({
</span><span class='line'>      selectedImage
</span><span class='line'>    })
</span><span class='line'>  }
</span><span class='line'>  render() {
</span><span class='line'>    const {images, selectedImage} = this.state;
</span><span class='line'>    return (
</span><span class='line'>      &lt;div className=&quot;image-gallery&quot;&gt;
</span><span class='line'>        &lt;div className=&quot;gallery-image&quot;&gt;
</span><span class='line'>          &lt;div&gt;
</span><span class='line'>            &lt;img src={selectedImage} /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div className=&quot;image-scroller&quot;&gt;
</span><span class='line'>          {images.map((image, index) =&gt; (
</span><span class='line'>            &lt;div key={index} onClick={this.handleThumbClick.bind(this,image)}&gt;
</span><span class='line'>              &lt;img src={image}/&gt;
</span><span class='line'>            &lt;/div&gt;
</span><span class='line'>          ))}
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    )
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="gi">+export default connect()(Gallery)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Importing the <code>connect</code> function from react-redux lets us export <code>Gallery</code> by wrapping it in the connect component. Notice that <code>connect()(Gallery)</code> puts <code>Gallery</code> in a second set of parentheses. This is because <code>connect()</code> returns a function that expects a React component as an argument. The call to <code>connect()</code> configures that function. Soon we&rsquo;ll pass in arguments to <code>connect</code> to configure it for our applications specific actions and state structure.</p>

<p>We are also exporting the <code>connect</code> call as the <code>default</code> for this module. This is important! Now, when we <code>import Gallery</code> it will import the connected component and not the basic class.</p>

<p><img src="https://s3.amazonaws.com/f.cl.ly/items/2k1Y1h3g1b0l1m0w212R/Screen%20Shot%202016-03-20%20at%206.42.19%20PM.png?v=bc54291d" alt="" /></p>

<p>If you look at the console log that we&rsquo;ve added to the constructor, you will see that the <code>Gallery</code> component&rsquo;s properties now include a <code>dispatch</code> function. This is part of what <code>connect</code> has modified for us, and gives us the ability to dispatch our own action objects to the applications reducers.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export class Gallery extends Component {
</span><span class='line'>  constructor(props) {
</span><span class='line'>    super(props);
</span><span class='line'><span class="gi">+    this.props.dispatch({type: &#39;TEST&#39;});</span>
</span><span class='line'>    this.state = {
</span><span class='line'>      images: []
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>[...]
</span></code></pre></td></tr></table></div></figure>


<p>We can test it out by calling dispatch in the constructor. You should see a log statement from our reducer in your developer console. We&rsquo;ve dispatched our first action! <em>Actions are plain old javascript objects</em> that have a required <code>type</code> property. They can have any number of other properties as well to pass along to the reducer, but the <code>type</code> property allows reducers to listen for specific actions that they are interested in.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export default function images(state, action) {
</span><span class='line'><span class="gd">-  console.log(state, action)</span>
</span><span class='line'><span class="gi">+  switch(action.type) {</span>
</span><span class='line'><span class="gi">+    case &#39;TEST&#39;:</span>
</span><span class='line'><span class="gi">+      console.log(&#39;THIS IS ONLY A TEST&#39;)</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'>  return state;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Generally reducers use a <code>switch</code> block to filter messages they are interested in. The <code>switch</code> uses the action&rsquo;s type, and the reducer does its work when it gets an action that matches one of the <code>case</code>s of the <code>switch</code>.</p>

<p>Our application is now wired to receive actions. Now we need to connect it to the state provided by the Redux store.</p>

<h3>Default application state</h3>

<p>Because we are using <code>connect</code>, we don&rsquo;t need to interact with the Redux store directly. We are going to configure a default application state to provide the Redux store.</p>

<h3>reducer.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>const defaultState = {
</span><span class='line'>  images: []
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export default function images(state = defaultState, action) {
</span><span class='line'>  switch(action.type) {
</span><span class='line'>    case &#39;TEST&#39;:
</span><span class='line'><span class="gd">-      console.log(&#39;THIS IS ONLY A TEST&#39;)</span>
</span><span class='line'><span class="gi">+      console.log(state, action)</span>
</span><span class='line'><span class="gi">+      return state;</span>
</span><span class='line'><span class="gi">+    default:</span>
</span><span class='line'><span class="gi">+      return state;</span>
</span><span class='line'>  }
</span><span class='line'><span class="gd">-  return state;</span>
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve created a <code>defaultState</code> object that has an empty array as its images property. We will set the <code>state</code> to default in the <code>images</code> function parameters. Now, if we log out the <code>state</code> property in our test case, you&rsquo;ll see that it isn&rsquo;t undefined! The reducer <strong>needs to return the current state</strong> of the application. This is important! Right now, we aren&rsquo;t making any changes, so we can just return the state. Note that we added a default case. The reducer should <em>always</em> return an object representing the state.</p>

<p>In the <code>Gallery</code> we can also connect the applications state by mapping it to properties:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import React, {Component} from &#39;react&#39;
</span><span class='line'>import {connect} from &#39;react-redux&#39;;
</span><span class='line'>
</span><span class='line'>export class Gallery extends Component {
</span><span class='line'>  constructor(props) {
</span><span class='line'>    super(props);
</span><span class='line'>    this.props.dispatch({type: &#39;TEST&#39;});
</span><span class='line'><span class="gi">+    console.log(props);</span>
</span><span class='line'><span class="gd">-    this.state = {</span>
</span><span class='line'><span class="gd">-      images: []</span>
</span><span class='line'><span class="gd">-    }</span>
</span><span class='line'>  }
</span><span class='line'><span class="gd">-  componentDidMount() {</span>
</span><span class='line'><span class="gd">-    const API_KEY = &#39;a46a979f39c49975dbdd23b378e6d3d5&#39;;</span>
</span><span class='line'><span class="gd">-    const API_ENDPOINT = `https://api.flickr.com/services/rest/?method=flickr.interestingness.-getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5`;-</span>
</span><span class='line'><span class="gd">-</span>
</span><span class='line'><span class="gd">-    fetch(API_ENDPOINT).then((response) =&gt; {</span>
</span><span class='line'><span class="gd">-      return response.json().then((json) =&gt; {</span>
</span><span class='line'><span class="gd">-        const images = json.photos.photo.map(({farm, server, id, secret}) =&gt; { </span>
</span><span class='line'><span class="gd">-            return `https://farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg`</span>
</span><span class='line'><span class="gd">-        });</span>
</span><span class='line'><span class="gd">-</span>
</span><span class='line'><span class="gd">-        this.setState({images, selectedImage: images[0]});</span>
</span><span class='line'><span class="gd">-      })</span>
</span><span class='line'><span class="gd">-    })</span>
</span><span class='line'><span class="gd">-  }</span>
</span><span class='line'><span class="gd">-  handleThumbClick(selectedImage) {</span>
</span><span class='line'><span class="gd">-    this.setState({</span>
</span><span class='line'><span class="gd">-      selectedImage</span>
</span><span class='line'><span class="gd">-    })</span>
</span><span class='line'><span class="gd">-  }</span>
</span><span class='line'>  render() {
</span><span class='line'><span class="gd">-    const {images, selectedImage} = this.state;</span>
</span><span class='line'><span class="gi">+    const {images, selectedImage} = this.props;</span>
</span><span class='line'>    return (
</span><span class='line'>      &lt;div className=&quot;image-gallery&quot;&gt;
</span><span class='line'>        &lt;div className=&quot;gallery-image&quot;&gt;
</span><span class='line'>          &lt;div&gt;
</span><span class='line'>            &lt;img src={selectedImage} /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div className=&quot;image-scroller&quot;&gt;
</span><span class='line'>          {images.map((image, index) =&gt; (
</span><span class='line'><span class="gd">-            &lt;div key={index} onClick={this.handleThumbClick.bind(this,image)}&gt;</span>
</span><span class='line'><span class="gi">+            &lt;div key={index}&gt;</span>
</span><span class='line'>              &lt;img src={image}/&gt;
</span><span class='line'>            &lt;/div&gt;
</span><span class='line'>          ))}
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    )
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="gi">+function mapStateToProps(state) {</span>
</span><span class='line'><span class="gi">+  return {</span>
</span><span class='line'><span class="gi">+    images: state.images</span>
</span><span class='line'><span class="gi">+    selectedImage: state.selectedImage</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'><span class="gi">+}</span>
</span><span class='line'>
</span><span class='line'><span class="gd">-export default connect()(Gallery)</span>
</span><span class='line'><span class="gi">+export default connect(mapStateToProps)(Gallery)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We are going to remove all of the image loading and interaction in the connected component for now. If you look towards the bottom of <code>Gallery</code> you will notice that we created a function called <code>mapStateToProps</code> that takes a <code>state</code> argument and returns an object that puts <code>state.images</code> into a property called <code>images</code>.  <code>mapStateToProps</code> is then passed as an argument to <code>connect</code>.</p>

<p>As the name suggests <code>mapStateToProps</code> is a function that takes the current state, and assigns it to properties of the component. If you <code>console.log(props)</code> in the constructor, you will see that we now have access to the images array that we set as the default state in our reducer!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>const defaultState = {
</span><span class='line'><span class="gd">-  images: []</span>
</span><span class='line'><span class="gi">+  images: [</span>
</span><span class='line'><span class="gi">+    &quot;https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg&quot;,</span>
</span><span class='line'><span class="gi">+    &quot;https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg&quot;,</span>
</span><span class='line'><span class="gi">+    &quot;https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg&quot;,</span>
</span><span class='line'><span class="gi">+    &quot;https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg&quot;,</span>
</span><span class='line'><span class="gi">+    &quot;https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg&quot;</span>
</span><span class='line'><span class="gi">+  ],</span>
</span><span class='line'><span class="gi">+  selectedImage: &quot;https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg&quot;</span>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export default function images(state = defaultState, action) {
</span><span class='line'>  switch(action.type) {
</span><span class='line'>    case &#39;TEST&#39;:
</span><span class='line'>      console.log(state, action)
</span><span class='line'>      return state;
</span><span class='line'>    default:
</span><span class='line'>      return state;
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>If you update the <code>images</code> array in the <code>defaultState</code> you should see some images reappear in the gallery! Now we need to get image selection wired back up with an action that is dispatched when the user clicks a thumbnail.</p>

<h3>Updating the state</h3>

<p>So how do we update the state with a new selected image?</p>

<p>We&rsquo;re going to configure the reducer to listen for an <code>IMAGE_SELECTED</code> action, and update the state with the action&rsquo;s payload.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>const defaultState = {
</span><span class='line'>  images: [
</span><span class='line'>    &quot;https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg&quot;,
</span><span class='line'>    &quot;https://farm2.staticflickr.com/1581/25283151224_50f8da511e.jpg&quot;,
</span><span class='line'>    &quot;https://farm2.staticflickr.com/1653/25265109363_f204ea7b54.jpg&quot;,
</span><span class='line'>    &quot;https://farm2.staticflickr.com/1571/25911417225_a74c8041b0.jpg&quot;,
</span><span class='line'>    &quot;https://farm2.staticflickr.com/1450/25888412766_44745cbca3.jpg&quot;
</span><span class='line'>  ],
</span><span class='line'>  selectedImage: &quot;https://farm2.staticflickr.com/1553/25266806624_fdd55cecbc.jpg&quot;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export default function images(state = defaultState, action) {
</span><span class='line'>  switch(action.type) {
</span><span class='line'><span class="gd">-    case &#39;TEST&#39;:</span>
</span><span class='line'>    case &#39;IMAGE_SELECTED&#39;:
</span><span class='line'><span class="gd">-      return state;</span>
</span><span class='line'><span class="gi">+      return {...state, selectedImage: action.image};</span>
</span><span class='line'>    default:
</span><span class='line'>      return state;
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Now the reducer is ready to receive the <code>IMAGE_SELECTED</code> action should it be dispatched! Inside of the case, we are returning a <strong>new state object</strong> by &ldquo;spreading&rdquo; the existing state and overwriting the <code>selectedImage</code> property. Checkout more on the <code>...state</code> object spread technique in <a href="https://egghead.io/lessons/javascript-redux-avoiding-array-mutations-with-concat-slice-and-spread">this video</a>. It&rsquo;s excellent.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import React, {Component} from &#39;react&#39;
</span><span class='line'>import {connect} from &#39;react-redux&#39;;
</span><span class='line'>
</span><span class='line'>export class Gallery extends Component {
</span><span class='line'><span class="gd">-  constructor(props) {</span>
</span><span class='line'><span class="gd">-    super(props);</span>
</span><span class='line'><span class="gd">-    this.props.dispatch({type: &#39;TEST&#39;});</span>
</span><span class='line'><span class="gd">-    console.log(props);</span>
</span><span class='line'><span class="gd">-  }</span>
</span><span class='line'>  render() {
</span><span class='line'><span class="gd">-    const {images, selectedImage} = this.props;</span>
</span><span class='line'><span class="gi">+    const {images, selectedImage, dispatch} = this.props;</span>
</span><span class='line'>
</span><span class='line'>    return (
</span><span class='line'>      &lt;div className=&quot;image-gallery&quot;&gt;
</span><span class='line'>        &lt;div className=&quot;gallery-image&quot;&gt;
</span><span class='line'>          &lt;div&gt;
</span><span class='line'>            &lt;img src={selectedImage} /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div className=&quot;image-scroller&quot;&gt;
</span><span class='line'>          {images.map((image, index) =&gt; (
</span><span class='line'><span class="gd">-            &lt;div key={index}&gt;</span>
</span><span class='line'><span class="gi">+            &lt;div key={index} onClick={() =&gt; dispatch({type:&#39;IMAGE_SELECTED&#39;, image})}&gt;</span>
</span><span class='line'>              &lt;img src={image}/&gt;
</span><span class='line'>            &lt;/div&gt;
</span><span class='line'>          ))}
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    )
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function mapStateToProps(state) {
</span><span class='line'>  return {
</span><span class='line'>    images: state.images,
</span><span class='line'>    selectedImage: state.selectedImage
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export default connect(mapStateToProps)(Gallery)
</span></code></pre></td></tr></table></div></figure>


<p>In the <code>Gallery</code>, we will use the <code>dispatch</code> function in the component props by calling it <em>inside of the body</em> of the <code>onClick</code> handler function. For now we are just writing it inline for convenience, but once we make that change, we can now click a thumbnail, and it will update the selected image via the reducer!</p>

<p>Using dispatch can be convenient way to quickly create generic actions, but soon we will want to make reusable actions that are well named. To do this, we will make use of &ldquo;action creators&rdquo;.</p>

<h3>Action Creators</h3>

<p>Action creators are functions that return configured action objects. We will add our first action creator to an new file called <code>actions.js</code>.</p>

<h3>actions.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="kr">const</span> <span class="nx">IMAGE_SELECTED</span> <span class="o">=</span> <span class="s1">&#39;IMAGE_SELECTED&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span> <span class="nx">selectImage</span><span class="p">(</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">type</span><span class="o">:</span> <span class="nx">IMAGE_SELECTED</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">image</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This could now be imported directly into any file that needed to create a <code>selectImage</code> action! <code>selectImage</code> is a pure function that only returns data. It takes an image as an argument, and adds that to the action object it creates and returns.</p>

<blockquote><p><strong>note:</strong> We are returning a plain JavaScript object, but the second property <code>image</code> might be weird if you haven&rsquo;t encountered this style before. Basically, in ES6, if you pass a property to an object like this it expands to <code>image: 'whatever value was held by image'</code> in the resulting object. Super handy.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span>  <span class="o">*</span> <span class="nx">as</span> <span class="nx">GalleryActions</span> <span class="nx">from</span> <span class="s1">&#39;./actions.js&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">[...]</span>
</span><span class='line'><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">GalleryActions</span><span class="p">.</span><span class="nx">selectImage</span><span class="p">(</span><span class="nx">image</span><span class="p">))}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This isn&rsquo;t much nicer than just using <code>dispatch</code> though.</p>

<p>Luckily for us, this pattern is so common, Redux provides a much nicer way to do this with the <code>bindActionCreators</code> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import React, {Component} from &#39;react&#39;
</span><span class='line'>import {connect} from &#39;react-redux&#39;;
</span><span class='line'><span class="gi">+ import {bindActionCreators} from &#39;redux&#39;;</span>
</span><span class='line'>
</span><span class='line'><span class="gi">+ import  * as GalleryActions from &#39;./actions.js&#39;;</span>
</span><span class='line'>
</span><span class='line'>export class Gallery extends Component {
</span><span class='line'>  constructor(props) {
</span><span class='line'>    super(props);
</span><span class='line'>    this.props.dispatch({type: &#39;TEST&#39;});
</span><span class='line'>    console.log(props);
</span><span class='line'>  }
</span><span class='line'>  handleThumbClick(selectedImage) {
</span><span class='line'>    this.setState({
</span><span class='line'>      selectedImage
</span><span class='line'>    })
</span><span class='line'>  }
</span><span class='line'>  render() {
</span><span class='line'><span class="gd">-    const {images, selectedImage, dispatch} = this.props;</span>
</span><span class='line'><span class="gi">+    const {images, selectedImage, selectImage} = this.props;</span>
</span><span class='line'>    return (
</span><span class='line'>      &lt;div className=&quot;image-gallery&quot;&gt;
</span><span class='line'>        &lt;div className=&quot;gallery-image&quot;&gt;
</span><span class='line'>          &lt;div&gt;
</span><span class='line'>            &lt;img src={selectedImage} /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div className=&quot;image-scroller&quot;&gt;
</span><span class='line'>          {images.map((image, index) =&gt; (
</span><span class='line'><span class="gd">-            &lt;div key={index} onClick={() =&gt; dispatch({type:&#39;IMAGE_SELECTED&#39;, image})}&gt;</span>
</span><span class='line'><span class="gi">+            &lt;div key={index} onClick={() =&gt; selectImage(image)}&gt;</span>
</span><span class='line'>              &lt;img src={image}/&gt;
</span><span class='line'>            &lt;/div&gt;
</span><span class='line'>          ))}
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    )
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function mapStateToProps(state) {
</span><span class='line'>  return {
</span><span class='line'>    images: state.images,
</span><span class='line'>    selectedImage: state.selectedImage
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="gi">+function mapActionCreatorsToProps(dispatch) {</span>
</span><span class='line'><span class="gi">+  return bindActionCreators(GalleryActions, dispatch);</span>
</span><span class='line'><span class="gi">+}</span>
</span><span class='line'>
</span><span class='line'><span class="gd">-export default connect(mapStateToProps)(Gallery)</span>
</span><span class='line'><span class="gi">+export default connect(mapStateToProps, mapActionCreatorsToProps)(Gallery)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve added a <code>mapActionCreatorsToProps</code> function that takes the <code>dispatch</code> function as an argument. It returns the result of a call to <code>bindActionCreators</code> with our <code>GalleryActions</code> provided as an argument. Now if you log the props, you&rsquo;ll see that <code>Gallery</code> <em>no longer gets passed the <code>dispatch</code> function</em>, and instead has a function called <code>selectImage</code> that we can use directly!</p>

<p>To review, we&rsquo;ve done several things:</p>

<ul>
<li>created a reducer that contains the initial (default) state of our application and listens for actions</li>
<li>created a store that consumes the reducer and provides a dispatcher that we can use to dispatch actions</li>
<li>connected our Gallery component to the store</li>
<li>mapped the store&rsquo;s state to props that are passed to the Gallery</li>
<li>mapped an action creator function so that the Gallery can simply call <code>selectImage(image)</code> and the application state will update.</li>
</ul>


<p>How do we use these patterns and load data from the remote data source?</p>

<p>This is where it gets interesting! <i class='emoji wink'></i></p>

<h2>Asyncronous activity?</h2>

<p>You may hear the term &ldquo;side effects&rdquo; used when discussing a functional style of programming. Side effects are things that occur outside the boundaries of the application. Within our cozy bubble, side effects aren&rsquo;t really a problem, but when we reach out to a remote service the bubble is pierced. We lose some control, and we have to accept that fact.</p>

<p>In Redux, <strong>reducers don&rsquo;t have side effects</strong>. This means that <strong>reducers don&rsquo;t handle async activity in our application</strong>. We can&rsquo;t use them to load our remote data because <strong>reducers are pure functions with no side effects</strong>.</p>

<p>Redux is wonderful, and if you donâ€™t have and side-effects like asynchronous activity you could stop right here. If youâ€™re creating more than the most trivial example, it is likely that you are loading data from a service, and this is of course async.</p>

<blockquote><p><strong>note:</strong> one of the coolest aspects of Redux is how tiny it is. It does so very little! It is intended to solve a very limited problem scope. Most applications will need to solve <strong>lots</strong> of problems! Luckily Redux provides the concept of &ldquo;middleware&rdquo;, which are basically bits of code that sit in the midel of the action &ndash;> reducer &ndash;> store triangle and provide a mechanism for introducing side effects like async calls to remote servers</p></blockquote>

<p>One approach is to use <strong><a href="https://en.wikipedia.org/wiki/Thunk">thunks</a></strong> with the <a href="https://github.com/gaearon/redux-thunk">redux-thunk</a> middleware. Thunks work great, but can get confusing for sequences of actions and can be challenging to test effectively.</p>

<p>Consider our image gallery application. When the application loads, it needs to:</p>

<ul>
<li>request an array of images from the server</li>
<li>display some notification that the images are loading</li>
<li>select an initial image for display when the results have been received</li>
<li>handle any errors that might occur</li>
</ul>


<p>This is all before the user has clicked anything in the application!</p>

<p>So how do we do it?</p>

<p>This is where <strong>redux-saga</strong> can be of great service to our application!</p>

<h2>redux-saga</h2>

<p>redux-saga is built to handle asynchronous actions in our Redux applications. It provides middleware and a handful of effects methods that make building complex sequences of asynchronous actions a breeze.</p>

<p>A saga is a <strong>generator</strong> function. Generators are an ES2015 addition to JavaScript. This might be your first encounter with generator functions, and if thatâ€™s the case, they might be a little weird. If that is the case, take a few minutes to read <a href="http://www.2ality.com/2015/03/es6-generators.html">ES6 Generators in Depth</a> and watch this <a href="https://egghead.io/lessons/ecmascript-6-generators">short generators video</a>. Donâ€™t fret to much if youâ€™re still scratching your head. To use redux-saga you wonâ€™t need a PhD in JavaScript Async Programming. Promise.</p>

<p>Because of the way generators work, we are able to create flat sequences of commands describing complex workflows within our application. The entire image loading sequence described above could look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">loadImages</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fetchImages</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">yield</span> <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;IMAGES_LOADED&#39;</span><span class="p">,</span> <span class="nx">images</span><span class="p">})</span>
</span><span class='line'>    <span class="nx">yield</span> <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;IMAGE_SELECTED&#39;</span><span class="p">,</span> <span class="nx">image</span><span class="o">:</span> <span class="nx">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">yield</span> <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;IMAGE_LOAD_FAILURE&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">})</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">watchForLoadImages</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">yield</span> <span class="nx">take</span><span class="p">(</span><span class="s1">&#39;LOAD_IMAGES&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">loadImages</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>The first saga</h3>

<p>We&rsquo;ll start with a simple example of a saga, and then we will configure redux-saga to connect it to our application. Create a file called <code>saga.js</code> in the source folder and add the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">sayHello</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our saga is simply a generator function. You can tell by the little <code>*</code> after <code>function*</code>. It&rsquo;s called the &ldquo;super star&rdquo; <i class='emoji star'></i>!</p>

<p>Now in <code>main.js</code> we will import our new function and execute it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import &quot;babel-polyfill&quot;;
</span><span class='line'>
</span><span class='line'>import React from &#39;react&#39;;
</span><span class='line'>import ReactDOM from &#39;react-dom&#39;;
</span><span class='line'>
</span><span class='line'>import Gallery from &#39;./Gallery&#39;;
</span><span class='line'>
</span><span class='line'>import { createStore } from &#39;redux&#39;
</span><span class='line'>import {Provider} from &#39;react-redux&#39;;
</span><span class='line'>import reducer from &#39;./reducer&#39;
</span><span class='line'>
</span><span class='line'><span class="gi">+import {sayHello} from &#39;./sagas&#39;;</span>
</span><span class='line'><span class="gi">+sayHello();</span>
</span><span class='line'>
</span><span class='line'>const store = createStore(reducer);
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'>  &lt;Provider store={store}&gt;
</span><span class='line'>    &lt;Gallery /&gt;
</span><span class='line'>  &lt;/Provider&gt;,
</span><span class='line'>  document.getElementById(&#39;root&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>No matter how long you stare at the console, your &ldquo;hello&rdquo; will never arrive <i class='emoji cry'></i></p>

<p>This is because <code>sayHello</code> is a <strong>generator</strong>! Generators don&rsquo;t execute immediately. If you changed the line to <code>sayHello().next();</code> your greating will appear. Don&rsquo;t worry, we won&rsquo;t call <code>next</code> all the time. Like Redux, redux-saga is built to remove pain and bolierplate and make our development experience more pleasurable.</p>

<h2>Configure redux-saga</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import &quot;babel-polyfill&quot;;
</span><span class='line'>
</span><span class='line'>import React from &#39;react&#39;;
</span><span class='line'>import ReactDOM from &#39;react-dom&#39;;
</span><span class='line'>
</span><span class='line'>import Gallery from &#39;./Gallery&#39;;
</span><span class='line'>
</span><span class='line'><span class="gd">-import { createStore } from &#39;redux&#39;</span>
</span><span class='line'><span class="gi">+import { createStore, applyMiddleware } from &#39;redux&#39;</span>
</span><span class='line'><span class="gi">+import createSagaMiddleware from &#39;redux-saga&#39;</span>
</span><span class='line'>import {Provider} from &#39;react-redux&#39;;
</span><span class='line'>import reducer from &#39;./reducer&#39;
</span><span class='line'>
</span><span class='line'>import {sayHello} from &#39;./sagas&#39;;
</span><span class='line'><span class="gd">-sayHello()</span>
</span><span class='line'>
</span><span class='line'><span class="gd">-const store = createStore(reducer);</span>
</span><span class='line'><span class="gi">+const store = createStore(</span>
</span><span class='line'><span class="gi">+  reducer,</span>
</span><span class='line'><span class="gi">+  applyMiddleware(createSagaMiddleware(sayHello))</span>
</span><span class='line'><span class="gi">+);</span>
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'>  &lt;Provider store={store}&gt;
</span><span class='line'>    &lt;Gallery /&gt;
</span><span class='line'>  &lt;/Provider&gt;,
</span><span class='line'>  document.getElementById(&#39;root&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve imported the <code>applyMiddleware</code> function from Redux, and the  <code>createSagaMiddleware</code> from <code>redux-saga</code>. When we create the store, we need to supply Redux with the middleware that we want to use. In this case we call <code>applyMiddleware</code> and send it the result of <code>createSagaMiddleware(sayHello)</code>. Behind the scenes redux-saga loads in the <code>sayHello</code> function, and politely calls the initial <code>next</code> for us.</p>

<p>It should greet you in the console!</p>

<p>Now let&rsquo;s build a saga for loading images.</p>

<h2>Loading Images with a Saga</h2>

<p>We&#8217;ill get rid of the <code>sayHello</code> saga and replace it with a <code>loadImages</code> saga in <code>sagas.js</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gd">-export function* sayHello() {</span>
</span><span class='line'><span class="gd">-  console.log(&#39;hello&#39;);</span>
</span><span class='line'><span class="gd">-}</span>
</span><span class='line'>
</span><span class='line'><span class="gi">+export function* loadImages() {</span>
</span><span class='line'><span class="gi">+  console.log(&#39;load some images please&#39;)</span>
</span><span class='line'><span class="gi">+}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t forget to update <code>main.js</code> as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import &quot;babel-polyfill&quot;;
</span><span class='line'>
</span><span class='line'>import React from &#39;react&#39;;
</span><span class='line'>import ReactDOM from &#39;react-dom&#39;;
</span><span class='line'>
</span><span class='line'>import Gallery from &#39;./Gallery&#39;;
</span><span class='line'>
</span><span class='line'>import { createStore, applyMiddleware } from &#39;redux&#39;
</span><span class='line'>import {Provider} from &#39;react-redux&#39;;
</span><span class='line'>import createSagaMiddleware from &#39;redux-saga&#39;
</span><span class='line'>import reducer from &#39;./reducer&#39;
</span><span class='line'>
</span><span class='line'><span class="gd">-import {sayHello} from &#39;./sagas&#39;;</span>
</span><span class='line'><span class="gi">+import {loadImages} from &#39;./sagas&#39;;</span>
</span><span class='line'>
</span><span class='line'>const store = createStore(
</span><span class='line'>  reducer,
</span><span class='line'><span class="gd">-  applyMiddleware(createSagaMiddleware(sayHello))</span>
</span><span class='line'><span class="gi">+  applyMiddleware(createSagaMiddleware(loadImages))</span>
</span><span class='line'>);
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'>  &lt;Provider store={store}&gt;
</span><span class='line'>    &lt;Gallery /&gt;
</span><span class='line'>  &lt;/Provider&gt;,
</span><span class='line'>  document.getElementById(&#39;root&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>And now the saga is loading. Let&rsquo;s add our <code>fetchImages</code> method we used earlier inside of <code>sagas.js</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="s1">&#39;a46a979f39c49975dbdd23b378e6d3d5&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">API_ENDPOINT</span> <span class="o">=</span> <span class="err">`</span><span class="nx">https</span><span class="o">:</span><span class="c1">//api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5`;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">fetchImages</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">API_ENDPOINT</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">json</span><span class="p">.</span><span class="nx">photos</span><span class="p">.</span><span class="nx">photo</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
</span><span class='line'>        <span class="p">({</span><span class="nx">farm</span><span class="p">,</span> <span class="nx">server</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">secret</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="err">`</span><span class="nx">https</span><span class="o">:</span><span class="c1">//farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg`</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">loadImages</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">fetchImages</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">images</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>fetchImages</code> method returns a promise. We are going to call <code>fetchImages</code>, but we are going to use the <code>yield</code> keyword. By dark arts and sorcery, generators <em>understand promises</em>, and as the console log will show, we&rsquo;ve yielded an array of image urls. Looking at <code>loadImages</code>, it looks like typical syncronous code. The <code>yield</code> keyword is the secret sauce that lets us code in this syncronous style for asyncronous activity.</p>

<h3>Encapsulating our async API requests</h3>

<p>Let&rsquo;s define the api we want to use in its own file. It is nothing special. In fact, it&rsquo;s the same code we used earlier to load Flickr images. We&rsquo;re going to create a file called <code>flickr.js</code> in the src folder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="s1">&#39;a46a979f39c49975dbdd23b378e6d3d5&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">API_ENDPOINT</span> <span class="o">=</span> <span class="err">`</span><span class="nx">https</span><span class="o">:</span><span class="c1">//api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=${API_KEY}&amp;format=json&amp;nojsoncallback=1&amp;per_page=5`;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchImages</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">API_ENDPOINT</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">json</span><span class="p">.</span><span class="nx">photos</span><span class="p">.</span><span class="nx">photo</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
</span><span class='line'>        <span class="p">({</span><span class="nx">farm</span><span class="p">,</span> <span class="nx">server</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">secret</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="err">`</span><span class="nx">https</span><span class="o">:</span><span class="c1">//farm${farm}.staticflickr.com/${server}/${id}_${secret}.jpg`</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>This isn&rsquo;t strictly required, but it makes a lot of sense to me. We are at the very <strong>boundaries of our application</strong>, where things are a bit messy. By encapsulating the mechanics of the interaction with the remote API, our code will be cleaner and easier to update. It also makes it dead simple to <em>completely swap out</em> the image service provider! Nice.</p>

<p>Our <code>saga.js</code> should now look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="p">{</span><span class="nx">fetchImages</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./flickr&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">loadImages</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">fetchImages</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">images</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We still need to get data out of our saga and into the application state. To handle this, we will utilize &ldquo;effects&rdquo; provided by redux-saga.</p>

<h3>Update the application from a saga</h3>

<p>We could probably call our saga with the <code>dispatch</code> function or store as an argument, but that approach would be unpleasant and perhaps a tad confusing over time. Instead, we&rsquo;ll rely on a method provided by redux-saga called <code>put</code>.</p>

<p>First we will update <code>reducer.js</code> to handle a new action type <code>IMAGES_LOADED</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>const defaultState = {
</span><span class='line'><span class="gi">+  images: []</span>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export default function images(state = defaultState, action) {
</span><span class='line'>  switch(action.type) {
</span><span class='line'>    case &#39;IMAGE_SELECTED&#39;:
</span><span class='line'>      return {...state, selectedImage: action.image};
</span><span class='line'><span class="gi">+    case &#39;IMAGES_LOADED&#39;:</span>
</span><span class='line'><span class="gi">+      return {...state, images: action.images};</span>
</span><span class='line'>    default:
</span><span class='line'>      return state;
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>We added the case, and also deleted the hard coded URLs from the <code>defaultState</code>. The <code>IMAGES_LOADED</code> case now returns an updated state that includes images delivered by the action.</p>

<p>Next we will update the saga:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'><span class="gi">+import {put} from &#39;redux-saga/effects&#39;;</span>
</span><span class='line'>
</span><span class='line'>export function* loadImages() {
</span><span class='line'>  const images = yield fetchImages();
</span><span class='line'><span class="gi">+  yield put({type: &#39;IMAGES_LOADED&#39;, images})</span>
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>After importing <code>put</code>, we add another line to <code>loadImages</code>. It <code>yield</code>s the result of the call the <code>put</code> which sends along an action object. Behind the scenes redux-saga dispatches that for us, and the reducer receives the message!</p>

<p>What if we don&rsquo;t want to loadImages implicitly like this, simply because we have wired up a saga? How do we trigger a saga with a specific type of action?</p>

<h3>Triggering saga workflows with actions</h3>

<p>Sagas become much more useful if we have the ability to trigger their workflows with Redux actions. When we do this, we can leverage the power of sagas from any component in our app. First we will create a new saga called <code>watchForLoadImages</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'><span class="gd">-import {put} from &#39;redux-saga/effects&#39;;</span>
</span><span class='line'><span class="gi">+import {put, take} from &#39;redux-saga/effects&#39;;</span>
</span><span class='line'>
</span><span class='line'>export function* loadImages() {
</span><span class='line'>  const images = yield fetchImages();
</span><span class='line'>  yield put({type: &#39;IMAGES_LOADED&#39;, images})
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="gi">+export function* watchForLoadImages() {</span>
</span><span class='line'><span class="gi">+  while(true) {</span>
</span><span class='line'><span class="gi">+    yield take(&#39;LOAD_IMAGES&#39;);</span>
</span><span class='line'><span class="gi">+    yield loadImages();</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'><span class="gi">+}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This new saga uses a <code>while</code> loop so that it is always active and ready. Inside of the loop we are yielding a call to a new method from redux-saga called <code>take</code>. Take listens for actions of a given type, and when they occur, it advances the saga to the next yield. In this case, we are yielding a call to <code>loadImages</code>, which initiates the loading of images.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import &quot;babel-polyfill&quot;;
</span><span class='line'>
</span><span class='line'>import React from &#39;react&#39;;
</span><span class='line'>import ReactDOM from &#39;react-dom&#39;;
</span><span class='line'>
</span><span class='line'>import Gallery from &#39;./Gallery&#39;;
</span><span class='line'>
</span><span class='line'>import { createStore, applyMiddleware } from &#39;redux&#39;
</span><span class='line'>import {Provider} from &#39;react-redux&#39;;
</span><span class='line'>import createSagaMiddleware from &#39;redux-saga&#39;
</span><span class='line'>import reducer from &#39;./reducer&#39;
</span><span class='line'>
</span><span class='line'><span class="gd">-import {loadImages} from &#39;./sagas&#39;;</span>
</span><span class='line'><span class="gi">+import {loadImages} from &#39;./watchForLoadImages&#39;;</span>
</span><span class='line'>
</span><span class='line'>const store = createStore(
</span><span class='line'>  reducer,
</span><span class='line'><span class="gd">-  applyMiddleware(createSagaMiddleware(loadImages))</span>
</span><span class='line'><span class="gi">+  applyMiddleware(createSagaMiddleware(watchForLoadImages))</span>
</span><span class='line'>);
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'>  &lt;Provider store={store}&gt;
</span><span class='line'>    &lt;Gallery /&gt;
</span><span class='line'>  &lt;/Provider&gt;,
</span><span class='line'>  document.getElementById(&#39;root&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>After updating <code>main.js</code>, the application is no longer loading images. We can add a <code>loadImages</code> action to our action creators.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export const IMAGE_SELECTED = &#39;IMAGE_SELECTED&#39;;
</span><span class='line'><span class="gi">+const LOAD_IMAGES = &#39;LOAD_IMAGES&#39;;</span>
</span><span class='line'>
</span><span class='line'>export function selectImage(image) {
</span><span class='line'>  return {
</span><span class='line'>    type: IMAGE_SELECTED,
</span><span class='line'>    image
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="gi">+export function loadImages() {</span>
</span><span class='line'><span class="gi">+  return {</span>
</span><span class='line'><span class="gi">+    type: LOAD_IMAGES</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'><span class="gi">+}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we have already bound the action creators, all we need to do is call the action from the <code>Gallery</code> component.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export class Gallery extends Component {
</span><span class='line'><span class="gi">+  componentDidMount() {</span>
</span><span class='line'><span class="gi">+    this.props.loadImages();</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'>  render() {
</span></code></pre></td></tr></table></div></figure>


<h3>Blocking and non-blocking effects</h3>

<p>This works fine for our application, but there is a broader issue that we should be concerned with. The <code>watchForLoadImages</code> sage contains <strong>blocking</strong> effects. What does that mean? Well, it means that we can only execute a single <code>LOAD_IMAGES</code> workflow at a time! It isn&rsquo;t obvious with a simple example like this, because we actually only load images once, but it is definitely a consideration. In fact, the general practice when listening for action evens is to use the <code>fork</code> effect instead of <code>yield loadImages()</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export function* watchForLoadImages() {
</span><span class='line'>  while(true) {
</span><span class='line'>    yield take(&#39;LOAD_IMAGES&#39;);
</span><span class='line'><span class="gd">-    yield loadImages();</span>
</span><span class='line'><span class="gi">+    yield fork(loadImages); //be sure to import it!</span>
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Using the <code>fork</code> helper will convert our <code>watchForLoadImages</code> into a non-blocking saga that can be executed regardless of whether or not a previous call is in progress. redux-saga <a href="http://yelouafi.github.io/redux-saga/docs/basics/UsingSagaHelpers.html">provides two helpers</a>, <code>takeEvery</code> and <code>takeLatest</code> that assist in these situations.</p>

<h3>Selecting the default image</h3>

<p>Sagas are sequences of actions, so we can add more aspects to a saga easily.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>import {put, take, fork} from &#39;redux-saga/effects&#39;;
</span><span class='line'>
</span><span class='line'>export function* loadImages() {
</span><span class='line'>  const images = yield fetchImages();
</span><span class='line'>  yield put({type: &#39;IMAGES_LOADED&#39;, images})
</span><span class='line'><span class="gi">+  yield put({type: &#39;IMAGE_SELECTED&#39;, image: images[0]})</span>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export function* watchForLoadImages() {
</span><span class='line'>  while(true) {
</span><span class='line'>    yield take(&#39;LOAD_IMAGES&#39;);
</span><span class='line'>    yield fork(loadImages);
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>As part of the <code>loadImages</code> workflow, we can yield another call to <code>put</code> with the <code>IMAGE_SELECTED</code> action type and send along the image we want to select when images are loaded.</p>

<h3>Handling errors</h3>

<p>If something goes wrong inside of the saga, we might want to notify the application so that it can respond accordingly. Do do this, we simply wrap the workflow in a try/catch block, and yield a <code>put</code> with a nitification that has the error as the payload.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>import {put, take, fork} from &#39;redux-saga/effects&#39;;
</span><span class='line'>
</span><span class='line'>export function* loadImages() {
</span><span class='line'><span class="gi">+  try {</span>
</span><span class='line'>    const images = yield fetchImages();
</span><span class='line'>    yield put({type: &#39;IMAGES_LOADED&#39;, images})
</span><span class='line'>    yield put({type: &#39;IMAGE_SELECTED&#39;, image: images[0]})
</span><span class='line'><span class="gi">+  } catch(error) {</span>
</span><span class='line'><span class="gi">+    yield put({type: &#39;IMAGE_LOAD_FAILURE&#39;, error})</span>
</span><span class='line'><span class="gi">+  }</span>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>export function* watchForLoadImages() {
</span><span class='line'>  while(true) {
</span><span class='line'>    yield take(&#39;LOAD_IMAGES&#39;);
</span><span class='line'>    yield fork(loadImages);
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Sagas</h2>

<p>Using Redux makes testing most of our app a breeze. Check out <a href="https://egghead.io/series/react-testing-cookbook">this egghead course</a> for lots of techniques for testing React in general.</p>

<p>One of the awesome aspects of redux-saga is how easy it makes testing these bits of asynchronous code. Testing async javascript can be a real chore. With sagas, we don&rsquo;t need to jump through hoops to test this core functionality of our application.  Sagas take the pain out of aync tests! Which means we will write more tests. Right?</p>

<p>We&rsquo;re going to use <a href="https://github.com/substack/tape">tape</a>. Let&rsquo;s set up a few tests for our saga.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import test from &#39;tape&#39;;
</span><span class='line'>import {put, take} from &#39;redux-saga/effects&#39;
</span><span class='line'>import {watchForLoadImages, loadImages} from &#39;./sagas&#39;;
</span><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>
</span><span class='line'>test(&#39;watchForLoadImages&#39;, assert =&gt; {
</span><span class='line'>  const generator = watchForLoadImages();
</span><span class='line'>
</span><span class='line'>  assert.end();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll go ahead and import everything we need for now, and add a single test. The test function takes a name and a function as arguments. Inside of the function, we create an instance of the sage generator. Armed with that instance, we can start advancing the saga to test each step.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import test from &#39;tape&#39;;
</span><span class='line'>import {put, take} from &#39;redux-saga/effects&#39;
</span><span class='line'>import {watchForLoadImages, loadImages} from &#39;./sagas&#39;;
</span><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>
</span><span class='line'>test(&#39;watchForLoadImages&#39;, assert =&gt; {
</span><span class='line'>  const generator = watchForLoadImages();
</span><span class='line'>
</span><span class='line'><span class="gi">+  assert.deepEqual(</span>
</span><span class='line'><span class="gi">+    generator.next().value,</span>
</span><span class='line'><span class="gi">+    false,</span>
</span><span class='line'><span class="gi">+    &#39;watchForLoadImages should be waiting for LOAD_IMAGES action&#39;</span>
</span><span class='line'><span class="gi">+  );</span>
</span><span class='line'>
</span><span class='line'>  assert.end();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>The <code>assert.deepEqual</code> method takes two values and checks to see if they are equal (deeply!). The first is a call <code>generator.next().value</code> which advances the generator and gets the value. The next value is simple <code>false</code>. We want to see it fail! The final argument is a description of the expected behavior.</p>

<p>Run <code>npm test</code> in the project folder to see the result.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>âœ– watchLoadImages should be waiting for LOAD_IMAGES action
</span><span class='line'><span class="gd">-----------------------------------------------------------</span>
</span><span class='line'>  operator: deepEqual
</span><span class='line'>  expected: |-
</span><span class='line'>    false
</span><span class='line'>  actual: |-
</span><span class='line'>    { TAKE: &#39;LOAD_IMAGES&#39; }
</span></code></pre></td></tr></table></div></figure>


<p>The test fails as expected and the results are interesting. The actual result is <code>{ TAKE: 'LOAD_IMAGES' }</code>, which is the output we receive when we call <code>take('LOAD_IMAGES');</code>. In fact, our saga could yield an object instead of calling <code>take</code>, but <code>take</code> gives us a little sugar and eliminates annoying keystrokes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import test from &#39;tape&#39;;
</span><span class='line'>import {put, take} from &#39;redux-saga/effects&#39;
</span><span class='line'>import {watchForLoadImages, loadImages} from &#39;./sagas&#39;;
</span><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>
</span><span class='line'>test(&#39;watchForLoadImages&#39;, assert =&gt; {
</span><span class='line'>  const generator = watchForLoadImages();
</span><span class='line'>
</span><span class='line'>  assert.deepEqual(
</span><span class='line'>    generator.next().value,
</span><span class='line'><span class="gd">-    false</span>
</span><span class='line'><span class="gi">+    take(&#39;LOAD_IMAGES&#39;),</span>
</span><span class='line'>    &#39;watchForLoadImages should be waiting for LOAD_IMAGES action&#39;
</span><span class='line'>  );
</span><span class='line'>
</span><span class='line'>  assert.end();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>We can simply call <code>take</code> in our test and get the result we need!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import test from &#39;tape&#39;;
</span><span class='line'>import {put, take} from &#39;redux-saga/effects&#39;
</span><span class='line'>import {watchForLoadImages, loadImages} from &#39;./sagas&#39;;
</span><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>
</span><span class='line'>test(&#39;watchForLoadImages&#39;, assert =&gt; {
</span><span class='line'>  const generator = watchForLoadImages();
</span><span class='line'>
</span><span class='line'>  assert.deepEqual(
</span><span class='line'>    generator.next().value,
</span><span class='line'>    take(&#39;LOAD_IMAGES&#39;),
</span><span class='line'>    &#39;watchForLoadImages should be waiting for LOAD_IMAGES action&#39;
</span><span class='line'>  );
</span><span class='line'>
</span><span class='line'><span class="gi">+  assert.deepEqual(</span>
</span><span class='line'><span class="gi">+    gen.next().value,</span>
</span><span class='line'><span class="gi">+    false,</span>
</span><span class='line'><span class="gi">+    &#39;watchForLoadImages should call loadImages after LOAD_IMAGES action is received&#39;</span>
</span><span class='line'><span class="gi">+  );</span>
</span><span class='line'>
</span><span class='line'>  assert.end();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>Our next test makes sure that the <code>loadImages</code> saga is called as the next step in the workflow. We&rsquo;ll add a false value here to see the result.</p>

<p>For a brief moment, let&rsquo;s update our saga code to yield the <code>loadImages</code> saga:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export function* watchForLoadImages() {
</span><span class='line'>  while(true) {
</span><span class='line'>    yield take(&#39;LOAD_IMAGES&#39;);
</span><span class='line'><span class="gi">+    yield loadImages();</span>
</span><span class='line'><span class="gd">-    yield fork(loadImages); //be sure to import it!</span>
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Now when you run the tests, you will see.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>âœ– watchForLoadImages should call loadImages after LOAD_IMAGES action is received
</span><span class='line'><span class="gd">---------------------------------------------------------------------------------</span>
</span><span class='line'>  operator: deepEqual
</span><span class='line'>  expected: |-
</span><span class='line'>    false
</span><span class='line'>  actual: |-
</span><span class='line'>    { _invoke: [Function: invoke] }
</span></code></pre></td></tr></table></div></figure>


<p>Hmm, <code>{ _invoke: [Function: invoke] }</code> is <em>definitely</em> not as obvious as the simple object that we got when yeilding <code>take</code>.</p>

<p>This is a problem. Luckily it&rsquo;s one that redux-saga has solved in a nice way with effects like <code>fork</code>. <code>take</code>, <code>fork</code>, and other effect methods return and easily testable simple object. The object is a <em>set of instructions</em> for redux-saga to execute. This is beautiful for testing because we don&rsquo;t have to worry about the actual side effects (like remote service calls). All we care about are the commands we are requesting to be executed.</p>

<p>Let&rsquo;s update the saga to use <code>fork</code> again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>export function* watchForLoadImages() {
</span><span class='line'>  while(true) {
</span><span class='line'>    yield take(&#39;LOAD_IMAGES&#39;);
</span><span class='line'><span class="gd">-    yield loadImages();</span>
</span><span class='line'><span class="gi">+    yield fork(loadImages);</span>
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>We will go back to <code>yield fork(loadImages)</code> instead of yielding <code>loadImages</code> directly. Note that we aren&rsquo;t executing <code>loadImages</code>. Instead we are *passing the function <code>loadImages</code> as an argument to <code>fork</code></p>

<p>Run <code>npm test</code> again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>âœ– watchForLoadImages should call loadImages after LOAD_IMAGES action is received
</span><span class='line'><span class="gd">---------------------------------------------------------------------------------</span>
</span><span class='line'>  operator: deepEqual
</span><span class='line'>  expected: |-
</span><span class='line'>    false
</span><span class='line'>  actual: |-
</span><span class='line'>    { FORK: { args: [], context: null, fn: [Function: loadImages] } }
</span></code></pre></td></tr></table></div></figure>


<p>Instead of a function invocation, we get a plain object. That object has the <code>loadImages</code> function embedded in it. The application loads exactly the same in the browser, but now we can easily test this step in the saga workflow.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>import test from &#39;tape&#39;;
</span><span class='line'>import {put, take} from &#39;redux-saga/effects&#39;
</span><span class='line'>import {watchForLoadImages, loadImages} from &#39;./sagas&#39;;
</span><span class='line'>import {fetchImages} from &#39;./flickr&#39;;
</span><span class='line'>
</span><span class='line'>test(&#39;watchForLoadImages&#39;, assert =&gt; {
</span><span class='line'>  const generator = watchForLoadImages();
</span><span class='line'>
</span><span class='line'>  assert.deepEqual(
</span><span class='line'>    generator.next().value,
</span><span class='line'>    take(&#39;LOAD_IMAGES&#39;),
</span><span class='line'>    &#39;watchForLoadImages should be waiting for LOAD_IMAGES action&#39;
</span><span class='line'>  );
</span><span class='line'>
</span><span class='line'>  assert.deepEqual(
</span><span class='line'>    generator.next().value,
</span><span class='line'><span class="gd">-    false,</span>
</span><span class='line'><span class="gi">+    yield fork(loadImages),</span>
</span><span class='line'>    &#39;watchForLoadImages should call loadImages after LOAD_IMAGES action is received&#39;
</span><span class='line'>  );
</span><span class='line'>
</span><span class='line'>  assert.end();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>Testing the <code>loadImages</code> saga is similar. We need to update <code>yield fetchImages</code> to <code>yield fork(fetchImages)</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;loadImages&#39;</span><span class="p">,</span> <span class="nx">assert</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">gen</span> <span class="o">=</span> <span class="nx">loadImages</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span>
</span><span class='line'>    <span class="nx">gen</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">call</span><span class="p">(</span><span class="nx">fetchImages</span><span class="p">),</span>
</span><span class='line'>    <span class="s1">&#39;loadImages should call the fetchImages api&#39;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span>
</span><span class='line'>    <span class="nx">gen</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">images</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;IMAGES_LOADED&#39;</span><span class="p">,</span> <span class="nx">images</span><span class="p">}),</span>
</span><span class='line'>    <span class="s1">&#39;loadImages should dispatch an IMAGES_LOADED action with the images&#39;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span>
</span><span class='line'>    <span class="nx">gen</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">images</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;IMAGE_SELECTED&#39;</span><span class="p">,</span> <span class="nx">image</span><span class="o">:</span> <span class="nx">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]}),</span>
</span><span class='line'>    <span class="s1">&#39;loadImages should dispatch an IMAGE_SELECTED action with the first image&#39;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span>
</span><span class='line'>    <span class="nx">gen</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="nx">error</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;IMAGE_LOAD_FAILURE&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">}),</span>
</span><span class='line'>    <span class="s1">&#39;loadImages should dispatch an IMAGE_LOAD_FAILURE if an error is thrown&#39;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">assert</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Take note of the last <code>assert</code>. It&rsquo;s testing the <code>catch</code> by using <code>throw</code> instead of <code>next</code> on the generator. Another cool feature is the ability to send values in. Notice that we&rsquo;ve created an <code>images</code> constant, and we pass that into <code>next</code>. The saga <em>uses the value we pass in</em> for the next step in the sequence.</p>

<p>It&rsquo;s awesome, and this level of control is a dream when it comes to testing async activity!</p>

<h2>What&rsquo;s next?</h2>

<p>You can <a href="https://github.com/joelhooks/egghead-react-redux-image-gallery">check out the full code for this example on github</a>. I&rsquo;m considering making a course on egghead to cover this. Would you be interested? <a href="https://twitter.com/jhooks">Let me know on twitter</a>!</p>

<p>If you wanted to expand the example a bit, you might:</p>

<ul>
<li>make it a slide show where the image advances to the next image on a timer</li>
<li>allow the user to search Flickr with keywords</li>
<li>drop in another API that delivers images</li>
<li>allow the user to select what APIs to search</li>
</ul>


<p>We&rsquo;ve only touched the surface of generators, but even at this level, hopefully you can see how useful they can be when coupled with the redux-saga library, Redux, and React.</p>

<p><img src="https://s3.amazonaws.com/f.cl.ly/items/2s2q3B3x0Q04131p3V0C/jhooks_2016-Mar-20.jpg?v=db21427c" alt="" /></p>

	</div>
	
	<div class="contact">Want to chat about this post? I'd love to hear from you. <br>You can find me on twitter <a href="http://twitter.com/jhooks" rel="author">@jhooks</a>, <a href="https://plus.google.com/+JoelHooks?rel=author" rel="author">google+</a>, or via email <a href="mailto:joelhooks@gmail.com?Subject=Hello%20,%20email%20from%20joelhooks.com">joelhooks@gmail.com</a></div>



</article>

</div>
	<footer id="footer" class="inner"><p>
you can learn more about me <a href="/about"> here.</a>
</p>
<p>
  ~ Copyright &copy; 2018 - Joel Hooks -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> ~
</p>


</footer>
	<script type="text/javascript" src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-246705-7']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);

		})();
		setTimeout(function() {
		   window.onscroll = function() {
		     window.onscroll = null; // Only track the event once
		     _gaq.push(['_trackEvent', 'scroll', 'read']);
		   }
		 }, 5000);
	</script>



    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>

    <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '51ddb932613f5d3030000126');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>


</script>
</body>
</html>
